# AutoPilot 脚本使用说明

## 脚本分类

AutoPilot 项目包含 102 个自动化脚本，按编程语言分类：

### 1. JavaScript 脚本 (61 个)

#### 签到类脚本 (50+ 个)
- `aliyun_drive.js` - 阿里云盘签到
- `qibida.js` - Q必达签到
- `meishu.js` - 美数签到
- `fsdlb.js` - 飞速登录签到
- `qbd.js` - QBD签到
- `mxbc.js` - 美币城签到
- `fenxiang.js` - 分享签到
- `yinxiang.js` - 印象签到
- `htx.js` - 火币签到
- `dw.js` - 达维签到
- `hyjk.js` - 健康卡签到
- `ftej.js` - 飞特签到
- `hl.js` - HL签到
- `dfyc.js` - 东方云彩签到
- `qtx.js` - 青天行签到
- `nhsy.js` - 农商银行签到
- `xinxi.js` - 信息签到
- `maisiweier.js` - 麦斯韦尔签到
- `gjzp.js` - 国际招聘签到
- `lenovoapp.js` - 联想签到
- `sytt.js` - 商通通签到
- `dffx.js` - 东方飞讯签到
- `gqftbz.js` - 共青体签到
- `xqz.js` - 小智签到
- `jlzx.js` - 金龙智选签到
- `musi.js` - 慕思签到
- `hfzj.js` - 杭州智驾签到
- `ddsy_songyao.js` - 叮当送药签到
- `didi.js` - 滴滴签到
- `shangzhanwangluo.js` - 商展网络签到
- `mtf.js` - 满分图签到
- `quzanmi.js` - 去赞米签到
- `jlqc.js` - 金龙汽车签到
- `haitianmeiweiguan.js` - 海天美味馆签到
- `dianxin.js` - 电信签到
- `yuebai.js` - 月白签到
- `baitianGame.js` - 百天游戏签到
- `bucket.js` - 桶签到
- `ksjsb.js` - 快捷记账签到
- `yingsheng_v2.js` - 影声签到
- `jingcaizhaopin.js` - 精彩招聘签到
- `piaopiaochaoshi.js` - 飘飘超市签到
- `huangli.js` - 黄历签到
- `shangzhan_wangluo.js` - 商战网络签到
- `sysxc.js` - 实现签到
- `gqaa.js` - 共青爱签到
- `ljfsjlb.js` - 龙江健身签到
- `yyq.js` - 网络签到
- `zhiwuxingqiu.js` - 植物星球签到
- `hqcsh.js` - 华清生活签到
- `xiaosatonglu.js` - 小沙通路签到
- `shangshaban.js` - 上上班签到
- `libai_vip.js` - 立白VIP签到
- `chaoxinwen.js` - 潮新闻签到
- `dt.js` - DT签到

#### 工具类脚本 (8 个)
- `modify_notify.js` - 修改通知配置
- `migrate_scripts.js` - 脚本批量迁移工具
- `notify_interceptor.js` - 青龙通知拦截
- `refactor_scripts.js` - 脚本批量重构工具
- `clean_emoji.py` - 清理emoji符号

#### 购物类脚本 (3 个)
- `meituan.js` - 美团签到

#### 生活类脚本 (4 个)
- `hyjk.js` - 健康卡签到
- `ddsy_songyao.js` - 叮当送药签到
- `huangli.js` - 黄历查询

#### 金融类脚本 (4 个)
- `unionpay.js` - 云闪付签到
- `dianxin.js` - 电信签到
- `jlyh.js` - 吉林银行签到
- `nhsy.js` - 农商银行签到

### 2. Python 脚本 (14 个)

#### 签到类脚本 (11 个)
- `aliyun_drive.py` - 阿里云盘签到
- `qidianwu_water.py` - 七点五签到
- `iqiyi.py` - 爱奇艺签到
- `dydd.py` - 大豆签到
- `changhongmeiling.py` - 长虹美菱签到
- `enshan.py` - 恩山签到
- `bjxd.py` - 北京现代签到
- `quanzhan.py` - 全站签到
- `yidongyunpan.py` - 移动云盘签到
- `7dian5.py` - 七点五签到
- `maomao_kankan.py` - 猫猫看看签到

#### 生活类脚本 (1 个)
- `dingdang_kuaiyao.py` - 叮当快药签到

#### 媒体类脚本 (1 个)
- `iqiyi.py` - 爱奇艺签到

#### 工具类脚本 (1 个)
- `clean_emoji.py` - 清理emoji符号

### 3. TypeScript 脚本 (23 个)

#### 签到类脚本 (18 个)
- `aliyun_drive.ts` - 阿里云盘签到
- `meituan.ts` - 美团签到
- `iqiyi.ts` - 爱奇艺签到
- `identical.ts` - 相同签到
- `huluwa.ts` - 葫芦娃签到
- `hl.ts` - HL签到
- `aima.ts` - 爱码签到
- `ipzan.ts` - IP赞签到
- `videoqq.ts` - 腾讯视频签到
- `ths.ts` - 同花顺签到
- `aicnn.ts` - AICNN签到
- `jsbaxfls.ts` - 健步房签到
- `imaotai.ts` - 茅台预约
- `yourapi.ts` - YourAPI签到
- `ssone.ts` - SSOne机场签到
- `ikuuu.ts` - ikuuu机场签到
- `newapi.ts` - NewAPI通用签到
- `ximalaya.ts` - 喜马拉雅签到

#### 信息类脚本 (2 个)
- `daily_news.ts` - 60s 读懂世界早报
- `weather_report.ts` - 每日天气预报

#### 工具类脚本 (3 个)
- `install_whistle.ts` - 安装Whistle代理
- `alipan_clean.ts` - 阿里云盘清理
- `disable_duplicate.ts` - 禁用青龙重复脚本

## 脚本使用说明

### 环境变量配置

每个脚本都有对应的环境变量，主要分为以下几类：

#### 1. Token/Cookie 类
大多数签到脚本需要 Token 或 Cookie，格式如下：

```bash
# 单账号
SCRIPT_TOKEN=your_token_here

# 多账号（使用 & 分隔）
SCRIPT_TOKEN=token1&token2&token3

# 多账号（使用换行分隔）
SCRIPT_TOKEN=token1
token2
token3

# 多账号（使用 @ 分隔）
SCRIPT_TOKEN=token1@token2@token3
```

#### 2. 账号密码类
部分脚本使用账号密码：

```bash
# 格式：用户名:密码
SCRIPT_CREDENTIAL=username:password

# 多账号
SCRIPT_CREDENTIAL=user1:pass1&user2:pass2
```

#### 3. JSON 配置类
部分脚本使用 JSON 格式配置：

```bash
SCRIPT_CONFIG={"key1":"value1","key2":"value2"}
```

### 获取 Token/Cookie 的方法

#### 1. 浏览器开发者工具（Chrome/Edge）
1. 按 F12 打开开发者工具
2. 切换到 "Network" 标签
3. 刷新页面或执行相关操作
4. 找到对应的请求
5. 查看 "Headers" 中的 "Cookie" 或 "Authorization" 字段

#### 2. 抓包工具
使用 Fiddler、Charles、Whistle 等抓包工具获取请求信息。

#### 3. 移动端抓包
使用 HTTPCanary、Packet Capture 等移动端抓包工具。

### 常见问题

#### 1. Token/Cookie 失效
- 重新获取 Token/Cookie
- 检查是否需要重新登录
- 部分网站 Token 有效期较短，需要定期更新

#### 2. 签到失败
- 检查 Token/Cookie 是否正确
- 检查网络连接
- 查看日志中的错误信息
- 部分网站有反爬虫机制，可能需要等待

#### 3. 多账号配置错误
- 确保分隔符使用正确（&、\n 或 @）
- 检查每个账号的格式是否正确
- 避免多余的空格或换行

## 脚本开发

### 添加新脚本
1. 阅读开发指南：`docs/DEVELOPMENT.md`
2. 使用标准模板结构
3. 遵循代码规范
4. 添加环境变量说明
5. 测试验证

### 脚本模板

#### JavaScript 模板
```javascript
/*
 * @Author: Astral
 * @Date: 2025-01-28
 * @Description: 脚本功能描述
 * @cron: 30 7 * * *
 * @new Env('脚本名称')
 * @环境变量: ENV_VAR_NAME 变量说明
 */

const { Env } = require('./utils/Env.js');

const $ = new Env('脚本名称', { sep: ['@', '\n', '&'] });

class Task {
  constructor(config, index) {
    this.config = config;
    this.index = index;
  }

  async start() {
    try {
      $.log(`\n========== 账号 ${this.index + 1} ==========`, 'info');

      // 业务逻辑
      await this.main();

      $.log(`账号 ${this.index + 1} 执行完成`, 'info');
    } catch (error) {
      $.log(`账号 ${this.index + 1} 执行失败: ${error.message}`, 'error');
    }
  }

  async main() {
    // 实现业务逻辑
  }
}

$.init(Task, 'ENV_VAR_NAME')
  .catch(error => {
    $.log(`程序执行失败: ${error.message}`, 'error');
  })
  .finally(() => {
    $.done();
  });
```

#### Python 模板
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
脚本功能描述
@Author: Astral
@Date: 2025-01-28
@cron: 30 7 * * *
@环境变量: ENV_VAR_NAME 变量说明
"""

import os
import sys
import requests
from typing import Dict, Any

class Task:
    def __init__(self, config: str, index: int):
        self.config = config.strip()
        self.index = index

    async def start(self) -> None:
        """主入口"""
        try:
            print(f"\n========== 账号 {self.index + 1} ==========")

            # 业务逻辑
            await self.main()

            print(f"账号 {self.index + 1} 执行完成")
        except Exception as e:
            print(f"账号 {self.index + 1} 执行失败: {str(e)}")

    async def main(self) -> None:
        """主逻辑"""
        # 1. 获取用户信息
        await self.get_user_info()

        # 2. 执行签到
        await self.sign_in()

        # 3. 领取奖励
        await self.get_reward()

    async def get_user_info(self) -> None:
        """获取用户信息"""
        try:
            print("获取用户信息...")

            response = requests.get(
                'https://api.example.com/user/info',
                headers={
                    'Authorization': f'Bearer {self.config}',
                    'User-Agent': 'AutoPilot/1.0'
                },
                timeout=10
            )

            if response.status_code == 200:
                data = response.json()
                print(f"用户: {data['data']['username']}")
            else:
                print(f"获取用户信息失败: {data.get('message')}")
        except Exception as e:
            print(f"获取用户信息异常: {str(e)}")

    async def sign_in(self) -> None:
        """签到"""
        try:
            print("开始签到...")

            response = requests.post(
                'https://api.example.com/user/signin',
                headers={
                    'Authorization': f'Bearer {self.config}',
                    'User-Agent': 'AutoPilot/1.0'
                },
                timeout=10
            )

            if response.status_code == 200:
                data = response.json()
                print(f"签到成功，获得 {data['data']['points']} 积分")
            elif response.status_code == 400 and '已签到' in data.get('message', ''):
                print("今日已签到")
            else:
                print(f"签到失败: {data.get('message')}")
        except Exception as e:
            print(f"签到异常: {str(e)}")

    async def get_reward(self) -> None:
        """领取奖励"""
        try:
            print("领取奖励...")

            response = requests.post(
                'https://api.example.com/user/reward',
                headers={
                    'Authorization': f'Bearer {self.config}',
                    'User-Agent': 'AutoPilot/1.0'
                },
                timeout=10
            )

            if response.status_code == 200:
                data = response.json()
                print(f"领取奖励成功: {data['data']['name']}")
            elif response.status_code == 400 and '已领取' in data.get('message', ''):
                print("奖励已领取")
            else:
                print(f"领取奖励失败: {data.get('message')}")
        except Exception as e:
            print(f"领取奖励异常: {str(e)}")

async def main():
    """主函数"""
    env_value = os.getenv('ENV_VAR_NAME')

    if not env_value:
        print("未找到环境变量 ENV_VAR_NAME")
        return

    # 解析多账号
    users = env_value.split('&')

    for idx, user_config in enumerate(users):
        if user_config.strip():
            task = Task(user_config, idx)
            await task.start()

if __name__ == '__main__':
    import asyncio
    asyncio.run(main())
```

#### TypeScript 模板
```typescript
/*
 * @Author: Astral
 * @Date: 2025-01-28
 * @Description: 脚本功能描述
 * @cron: 30 7 * * *
 * @new Env('脚本名称')
 * @环境变量: ENV_VAR_NAME 变量说明
 */

import { Env } from '../utils';

const $ = new Env('脚本名称', { sep: ['@', '\n', '&'] });

class Task {
  constructor(private config: string, private index: number) {}

  async start(): Promise<void> {
    try {
      $.log(`\n========== 账号 ${this.index + 1} ==========`, 'info');

      // 业务逻辑
      await this.main();

      $.log(`账号 ${this.index + 1} 执行完成`, 'info');
    } catch (error) {
      $.log(`账号 ${this.index + 1} 执行失败: ${(error as Error).message}`, 'error');
    }
  }

  private async main(): Promise<void> {
    // 实现业务逻辑
  }
}

$.init(Task, 'ENV_VAR_NAME')
  .catch(error => {
    $.log(`程序执行失败: ${(error as Error).message}`, 'error');
  })
  .finally(() => {
    $.done();
  });
```

## 脚本命名规范

所有脚本按功能命名，通过文件名体现其用途：

- 签到类：`xxx_signin.js` 或 `xxx.js`
- 信息类：`xxx_news.js` 或 `xxx_report.js`
- 工具类：`xxx_clean.js` 或 `xxx_tool.js`
- 媒体类：`xxx_video.js` 或 `xxx_media.js`

## 更多信息

- GitHub: https://github.com/astralwaveorg/autopilot
- 使用文档: [USAGE.md](./USAGE.md)
- 开发指南: [DEVELOPMENT.md](./DEVELOPMENT.md)
- 问题反馈: https://github.com/astralwaveorg/autopilot/issues

## 许可证

MIT License